<!-- 
    GHL GITHUB LOADER 
    Paste this into the "Custom Code" (Header or Body) of your GHL Page.
    It will fetch the latest content from your GitHub Pages URL and inject it.
-->
<div id="app-container">
    <style>
        body { margin: 0; padding: 0; background: #000; color: #fff; display: flex; align-items: center; justify-content: center; height: 100vh; font-family: sans-serif; }
        .loader { border: 4px solid #333; border-top: 4px solid #FF00FF; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
    <div class="loader"></div>
</div>

<script>
    // CONFIGURATION: Using RAW GitHub URLs to bypass DNS propagation
    
    // 1. HOME PAGE:
    const GITHUB_FILE_URL = 'https://raw.githubusercontent.com/exposuresolutions/flavors-zante/main/Clients/FLAVORS/ghl/flavors-zante-v5.html';
    
    // 2. TRAFFIC LIGHT APP:
    // const GITHUB_FILE_URL = 'https://raw.githubusercontent.com/exposuresolutions/flavors-zante/main/Clients/FLAVORS/ghl/flavors-traffic.html';

    // 3. FEEDBACK / ONBOARDING:
    // const GITHUB_FILE_URL = 'https://raw.githubusercontent.com/exposuresolutions/flavors-zante/main/Clients/FLAVORS/ghl/feedback-survey.html';

    async function loadContent() {
        try {
            // 1. Fetch the raw HTML from GitHub
            const response = await fetch(GITHUB_FILE_URL);
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            const html = await response.text();

            // 2. Parse the HTML
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');

            // CLEANUP: Remove existing GHL styles/classes that might conflict
            document.body.className = '';
            document.body.style = '';
            
            // Remove existing viewport meta tags to prevent conflicts
            const existingViewports = document.querySelectorAll('meta[name="viewport"]');
            existingViewports.forEach(el => el.remove());

            // 3. Replace the current page content
            
            // HEAD INJECTION (Styles, Fonts, Metadata, Scripts)
            Array.from(doc.head.children).forEach(child => {
                if (child.tagName === 'TITLE') return;
                
                // Explicitly recreate scripts in HEAD to ensure they execute
                if (child.tagName === 'SCRIPT') {
                    const newScript = document.createElement('script');
                    Array.from(child.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value));
                    newScript.appendChild(document.createTextNode(child.innerHTML));
                    document.head.appendChild(newScript);
                } else {
                    document.head.appendChild(child);
                }
            });
            document.title = doc.title;

            // BODY INJECTION
            document.body.innerHTML = doc.body.innerHTML;

            // BODY SCRIPT RE-EXECUTION (Find scripts in the LIVE document, not the parsed one)
            Array.from(document.body.querySelectorAll('script')).forEach(oldScript => {
                const newScript = document.createElement('script');
                Array.from(oldScript.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value));
                newScript.appendChild(document.createTextNode(oldScript.innerHTML));
                oldScript.parentNode.replaceChild(newScript, oldScript);
            });

            console.log('Content loaded from GitHub successfully.');

        } catch (error) {
            console.error('Failed to load content:', error);
            document.getElementById('app-container').innerHTML = '<p style="color:red; text-align:center;">Error loading content. Please check console.</p>';
        }
    }

    loadContent();
</script>
